

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Containers Tutorial &mdash; AI/ML TACC Introduction  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lets Get Advanced" href="../Lets%20Get%20Advanced%20Section/Lets%20Get%20Advanced.html" />
    <link rel="prev" title="How to Install Conda" href="How%20to%20Install%20Conda.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AI/ML TACC Introduction
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="Getting%20Started.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Connecting%20to%20TACC.html">Connecting to TACC</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="How%20Are%20They%20Different.html">How They Are Different</a></li>
<li class="toctree-l2"><a class="reference internal" href="How%20to%20Create%20and%20Activate%20a%20Virtual%20Environment.html">How to Create and Activate a Virtual Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="How%20to%20Install%20Conda.html">How to Install Conda</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Containers Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-a-docker-image">What is a Docker Image?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#apptainer-vs-container">Apptainer vs Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#steps-to-install-pytorch-with-cuda-on-docker">Steps to Install PyTorch with CUDA on Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Lets%20Get%20Advanced%20Section/Lets%20Get%20Advanced.html">Lets Get Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Conda%20Tips%20Section/Conda%20Tips%20and%20Tricks.html">Conda Tips and Tricks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AI/ML TACC Introduction</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="Getting%20Started.html">Getting Started</a></li>
      <li class="breadcrumb-item active">Containers Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Getting Started Section/Containers Tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="containers-tutorial">
<h1>Containers Tutorial<a class="headerlink" href="#containers-tutorial" title="Link to this heading"></a></h1>
<p>Docker is a platform for developing, shipping, and running applications inside containers. Containers are lightweight, portable, and ensure that applications run consistently across different environments. However, since we will be working on TACC’s HPC systems, this tutorial will be using Apptainer.</p>
<section id="what-is-a-docker-image">
<h2>What is a Docker Image?<a class="headerlink" href="#what-is-a-docker-image" title="Link to this heading"></a></h2>
<p>A Docker image is a pre-configured package that contains everything needed to run an application, including the code, runtime, libraries, and dependencies. Once an image is instantiated, it becomes a container, which is an isolated runtime environment.</p>
</section>
<section id="apptainer-vs-container">
<h2>Apptainer vs Container<a class="headerlink" href="#apptainer-vs-container" title="Link to this heading"></a></h2>
<p>Apptainer (formerly Singularity) is a containerization platform designed specifically for high-performance computing (HPC) environments, offering a solution optimized for scientific research and large-scale data processing. Unlike general containers like Docker, which require root privileges and are commonly used for development and cloud-based applications, Apptainer is built to run efficiently on shared systems, such as TACC’s supercomputers and clusters. It provides portability, reproducibility, and seamless integration with HPC job schedulers making it ideal for researchers who need to run complex applications in secure, isolated environments without compromising performance or requiring administrative access.</p>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Before you begin, ensure that you have the following:</dt><dd><ul class="simple">
<li><p>A working internet connection to download Docker.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="steps-to-install-pytorch-with-cuda-on-docker">
<h2>Steps to Install PyTorch with CUDA on Docker<a class="headerlink" href="#steps-to-install-pytorch-with-cuda-on-docker" title="Link to this heading"></a></h2>
<p>we call it this but its not really ON docker or using docker other than docker hub, is this the intended tutorial? im not sure if i have it right
Apptainer runs Docker containers on HPC systems</p>
<p><strong>Step 1: Install Docker (if not already installed)</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://docs.docker.com/desktop/setup/install/mac-install/">Mac</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/desktop/setup/install/windows-install/">Windows</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/desktop/setup/install/linux/">Linux</a></p></li>
</ul>
</div></blockquote>
<p><strong>Step 2: Run the SSH Command</strong>
Use the following command to connect to TACC systems:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;@&lt;</span><span class="n">hostname</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>(replace <cite>&lt;username&gt;</cite> with your TACC username and <cite>&lt;hostname&gt;</cite> with the system hostname)</p>
<p><strong>Example:</strong>
To connect to the Frontera system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">username</span><span class="nd">@frontera</span><span class="o">.</span><span class="n">tacc</span><span class="o">.</span><span class="n">utexas</span><span class="o">.</span><span class="n">edu</span>
</pre></div>
</div>
<p><strong>Step 3: Enter Your Password</strong>
When prompted, type your TACC password. If this is your first time logging in, you may be required to set up or reset your password.</p>
<p><strong>Step 4: Two-Factor Authentication</strong>
TACC systems require two-factor authentication. Follow the on-screen prompts to complete the process.</p>
<p><strong>Step 5: Request a Node</strong>
If you try to download a Docker image right off the bat, your terminal will warn you!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(base) something$ idev -N 2 -n 2 -p rtx-dev -t 02:00:00
</pre></div>
</div>
<p>//explain what this means, the Flags
This might take a while but you will know that you have successfully loaded into a node when your command line shows (base) some numbers and what not</p>
<p><strong>Step 6:  Load in Apptainer</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(base) something$ module list

Currently Loaded Modules:
1) intel/19.1.1   4) autotools/1.2   7) hwloc/1.11.12  10) tacc-apptainer/1.3.3
2) impi/19.0.9    5) python3/3.7.0   8) xalt/2.10.34
3) git/2.24.1     6) cmake/3.24.2    9) TACC


(base) something$ module load tacc-apptainer

verify with:
(base) something$ type apptainer

apptainer is /opt/apps/tacc-apptainer/1.3.3/bin/apptainer
</pre></div>
</div>
<p><strong>Step 5. Pull a Prebuilt PyTorch Docker Image</strong></p>
<p>Instead of creating our own Dockerfile, we can use an official PyTorch image from DockerHub</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>DockerHub is official cloud-based repository where developers store, share, and distribute Docker images. Similar to GitHub but for Docker containers.</p>
</div>
<p>Run the following command to pull the latest PyTorch image with CUDA support.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apptainer</span> <span class="n">pull</span> <span class="n">output</span><span class="o">.</span><span class="n">sif</span> <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">pytorch</span><span class="o">/</span><span class="n">pytorch</span><span class="p">:</span><span class="mf">2.5.1</span><span class="o">-</span><span class="n">cuda12</span><span class="mf">.4</span><span class="o">-</span><span class="n">cudnn9</span><span class="o">-</span><span class="n">devel</span>
</pre></div>
</div>
<p>This will download the image and convert it into an Apptainer image format (.sif).
You can replace “output.sif” with whatever you would like to name the file. Otherwise it will default to the name of the image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CUDA is an API that allows software to utilize NVIDIA GPUs for accelerated computing. This is essential for deep learning because GPUs process tasks much faster than CPUs.
Since TACC machines have NVIDIA GPUs, we must use a CUDA-enabled PyTorch image to fully leverage GPU acceleration.</p>
</div>
<p><strong>Step 7. Start an Interactive Apptainer Shell</strong></p>
<p>Once the image is downloaded, we can enter the Apptainer shell by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(base) something$ apptainer shell output.sif
</pre></div>
</div>
<p>Now we are in our own isolated environment free to do whatever we would like with it.</p>
<p><strong>Step 8. Testing it Out</strong></p>
<blockquote>
<div><p>Once inside the container, switch over to your $SCRATCH directory and install this script.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(base) soemthing$ git clone https://github.com/pytorch/examples.git

(base) something$ torchrun --nproc_per_node=4 examples/distributed/ddp-tutorial-series/multigpu_torchrun.py 50 10
</pre></div>
</div>
<p><strong>Step 9: Verifying the Script Execution</strong>
Once you’ve executed the script, you can check the output directly in your terminal. If there are any issues or errors, they will be displayed in the terminal.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading"></a></h2>
<p>You have now successfully pulled a PyTorch image from Docker Hub, mounted local directories into the container, and run a Python script within an Apptainer container.</p>
<p>Special thanks to the Containers at TACC tutorial <a class="reference external" href="https://containers-at-tacc.readthedocs.io/en/latest/index.html">https://containers-at-tacc.readthedocs.io/en/latest/index.html</a></p>
<p>For further help, refer to the official Apptainer documentation at:
<a class="reference external" href="https://apptainer.org/docs">https://apptainer.org/docs</a></p>
<p>First example, single node pytorch installation guide with just tacc machine
Look at gabriels doc for differnt pytorch images</p>
<p>Second example, build docker file on local, push to docker hub, pull onto tacc system</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="How%20to%20Install%20Conda.html" class="btn btn-neutral float-left" title="How to Install Conda" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Lets%20Get%20Advanced%20Section/Lets%20Get%20Advanced.html" class="btn btn-neutral float-right" title="Lets Get Advanced" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Texas Advanced Computing Center.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>